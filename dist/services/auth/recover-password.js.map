{"version":3,"sources":["../../../src/services/auth/recover-password.ts"],"sourcesContent":["import { error } from 'elysia'\n\nimport nodemailer from 'nodemailer'\n\nimport { User } from '@/models/User'\nimport { hashPassword } from '@/shared/hashing-password'\n\nexport const recoverPasswordService = async (email: string) => {\n  const user = await User.findOne({ email })\n\n  if (!user) {\n    throw error('Not Found', { error: 'User not found' })\n  }\n\n  const resetToken = Math.random().toString(36).slice(-8)\n  const hashedToken = await hashPassword(resetToken)\n\n  user.resetPasswordToken = hashedToken\n  user.resetPasswordExpires = new Date(Date.now() + 3600000) // 1 hour\n  await user.save()\n\n  const transporter = nodemailer.createTransport({\n    host: process.env.MAIL_HOST,\n    port: Number(process.env.MAIL_PORT),\n    secure: true,\n    auth: {\n      user: process.env.MAIL_USERNAME,\n      pass: process.env.MAIL_PASSWORD\n    }\n  })\n\n  await transporter\n    .sendMail({\n      from: process.env.MAIL_USERNAME,\n      to: email,\n      subject: 'Password Recovery',\n      text: `Your password reset token is: ${resetToken}. This token will expire in 1 hour.`\n    })\n    .catch(() => {\n      throw error('Internal Server Error', { error: 'Failed to send recovery email' })\n    })\n\n  return true\n}\n"],"names":["recoverPasswordService","email","user","User","findOne","error","resetToken","Math","random","toString","slice","hashedToken","hashPassword","resetPasswordToken","resetPasswordExpires","Date","now","save","transporter","nodemailer","createTransport","host","process","env","MAIL_HOST","port","Number","MAIL_PORT","secure","auth","MAIL_USERNAME","pass","MAIL_PASSWORD","sendMail","from","to","subject","text","catch"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPS;mEAEC;sBAEF;iCACQ;;;;;;AAEtB,MAAMA,yBAAyB,OAAOC;IAC3C,MAAMC,OAAO,MAAMC,UAAI,CAACC,OAAO,CAAC;QAAEH;IAAM;IAExC,IAAI,CAACC,MAAM;QACT,MAAMG,IAAAA,aAAK,EAAC,aAAa;YAAEA,OAAO;QAAiB;IACrD;IAEA,MAAMC,aAAaC,KAAKC,MAAM,GAAGC,QAAQ,CAAC,IAAIC,KAAK,CAAC,CAAC;IACrD,MAAMC,cAAc,MAAMC,IAAAA,6BAAY,EAACN;IAEvCJ,KAAKW,kBAAkB,GAAGF;IAC1BT,KAAKY,oBAAoB,GAAG,IAAIC,KAAKA,KAAKC,GAAG,KAAK,SAAS,SAAS;;IACpE,MAAMd,KAAKe,IAAI;IAEf,MAAMC,cAAcC,mBAAU,CAACC,eAAe,CAAC;QAC7CC,MAAMC,QAAQC,GAAG,CAACC,SAAS;QAC3BC,MAAMC,OAAOJ,QAAQC,GAAG,CAACI,SAAS;QAClCC,QAAQ;QACRC,MAAM;YACJ3B,MAAMoB,QAAQC,GAAG,CAACO,aAAa;YAC/BC,MAAMT,QAAQC,GAAG,CAACS,aAAa;QACjC;IACF;IAEA,MAAMd,YACHe,QAAQ,CAAC;QACRC,MAAMZ,QAAQC,GAAG,CAACO,aAAa;QAC/BK,IAAIlC;QACJmC,SAAS;QACTC,MAAM,CAAC,8BAA8B,EAAE/B,WAAW,mCAAmC,CAAC;IACxF,GACCgC,KAAK,CAAC;QACL,MAAMjC,IAAAA,aAAK,EAAC,yBAAyB;YAAEA,OAAO;QAAgC;IAChF;IAEF,OAAO;AACT"}